#!/bin/bash
# to be executed in parent directory of /translations

Component=${PWD##*/}
PARENTDIR=$(basename $(dirname $PWD))

case "$Component" in
	*leave*) 
	echo "leave stuff, skipping...";;# to do
	
	qterminal)
	echo "qterminal, skipping...";;#to do

	src) # components using src/translations
	for file in translations/desktop_*.ts
		do
		language=$(cat $file | grep -o -P '(?<=language=\").*(?=\"\>)')
		echo "# Do not edit, file generated by lxqt-ts2desktop. Please edit only desktop_*.ts files in LXQt-Weblate or Qt-Linguist" >  translations"/"$PARENTDIR"_"$language.desktop
  		cat $file |grep -oP '(?<=translation>)[^<]+' | sed -n 1p | sed 's/^/Name['$language']=/' >> translations"/"$PARENTDIR"_"$language.desktop
		cat $file |grep -oP '(?<=translation>)[^<]+' | sed -n 2p | sed 's/^/GenericName['$language']=/' >>  translations"/"$PARENTDIR"_"$language.desktop
		cat $file |grep -oP '(?<=translation>)[^<]+' | sed -n 3p | sed 's/^/Comment['$language']=/' >>  translations"/"$PARENTDIR"_"$language.desktop
	done ;;
	
	*) # components using /translations in source dir
	for file in translations/desktop_*.ts
		do
		language=$(cat $file | grep -o -P '(?<=language=\").*(?=\"\>)')
		echo "# Do not edit, file generated by lxqt-ts2desktop. Please edit only desktop_*.ts files in LXQt-Weblate or Qt-Linguist" >  translations"/"$Component"_"$language.desktop
  		cat $file |grep -oP '(?<=translation>)[^<]+' | sed -n 1p | sed 's/^/Name['$language']=/' >> translations"/"$Component"_"$language.desktop
		cat $file |grep -oP '(?<=translation>)[^<]+' | sed -n 2p | sed 's/^/GenericName['$language']=/' >>  translations"/"$Component"_"$language.desktop
		cat $file |grep -oP '(?<=translation>)[^<]+' | sed -n 3p | sed 's/^/Comment['$language']=/' >>  translations"/"$Component"_"$language.desktop
	done ;;
	
esac
